<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>宠物商店</title>
    <link rel="stylesheet" type="text/css" href="./css/api.css" />
    <style type="text/css">

    </style>
</head>

<body class="wrap">

</body>
<script type="text/javascript" src="./script/api.js"></script>
<script type="text/javascript" src="./script/db.js"></script>
<script type="text/javascript">
apiready = function() {
      init();
      fnGetWareTypeList();
      initDatabase();
      api.openWin({
          name: 'main',
          url: './html/main.html',
          pageParam: {
              name: 'test'
          }
      });
};

function init(){
      var wareTypeList = $api.getStorage('wareTypeList');
      if(!wareTypeList){
        wareTypeList = [{
        "id": "5cc66db0dfb03a372f54d6ca",
        "name": "热门爱汪",
        "createdAt": "2019-04-29T03:21:20.010Z",
        "updatedAt": "2019-04-29T07:25:17.912Z",
        "price": "3000"
      },{
        "id": "5cc66dbcd5268ca31499876e",
        "name": "热门爱喵",
        "createdAt": "2019-04-29T03:21:32.461Z",
        "updatedAt": "2019-04-29T03:21:32.461Z"
      },{
        "id": "5cc66dc526bd520c2c4163dc",
        "name": "宠物食品",
        "createdAt": "2019-04-29T03:21:41.150Z",
        "updatedAt": "2019-04-29T03:21:41.150Z"
      },{
        "id": "5cc66dcc9ea5fc091051e6ef",
        "name": "宠物用品",
        "createdAt": "2019-04-29T03:21:48.350Z",
        "updatedAt": "2019-04-29T03:21:48.350Z"
      }];
    }
    var db = api.require('db');
    db.openDatabaseSync({
        name: 'petStore_DB',
        path: 'fs://test.db'
    });
}

function fnGetWareTypeList(){
      var params = {
        fields:{},
        where:{},
        skip:0,
        limit:4
      }
      params = $api.jsonToStr(params);
      api.ajax({
          url: 'http://d.apicloud.com/mcm/api/wareType?filter=' + params,
          method: 'get',
          headers: {
            "X-APICloud-AppId":	"A6000926714852",
            "X-APICloud-AppKey":"5fe9e06dfbe11c046d6e760665bd6b335d6173b6.1556419150650"
          },
      },function(ret, err){
          if (ret) {
              //alert( JSON.stringify( ret ) );
              $api.setStorage('wareTypeList', ret);
          } else {
              alert( JSON.stringify( err ) );
          }
      });
}

function initDatabase(){
    $db.open();
}


</script>

</html>
